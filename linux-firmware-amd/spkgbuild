# description  : Firmware files for Linux

name=linux-firmware-amd
version=20230625
release=1
baseurl=https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/plain
amdf=fam19h
agpu=green_sardine_
rtlk=rtl8168h-2
source="${baseurl}/amd-ucode/microcode_amd_${amdf}.bin 
  ${baseurl}/amd-ucode/microcode_amd_${amdf}.bin.asc
  ${baseurl}/amd/amd_sev_${amdf}_model0xh.sbin
  ${baseurl}/amdgpu/${agpu}asd.bin 
  ${baseurl}/amdgpu/${agpu}ce.bin 
  ${baseurl}/amdgpu/${agpu}dmcub.bin 
  ${baseurl}/amdgpu/${agpu}me.bin 
  ${baseurl}/amdgpu/${agpu}mec.bin 
  ${baseurl}/amdgpu/${agpu}mec2.bin 
  ${baseurl}/amdgpu/${agpu}pfp.bin 
  ${baseurl}/amdgpu/${agpu}rlc.bin 
  ${baseurl}/amdgpu/${agpu}sdma.bin 
  ${baseurl}/amdgpu/${agpu}ta.bin 
  ${baseurl}/amdgpu/${agpu}vcn.bin
  ${baseurl}/rtl_nic/${rtlk}.fw"

build() {

  # create $PKG dirs
  for i in amd amdgpu amd-ucode rtl_nic; do
    mkdir -pv $PKG/lib/firmware/${i}
  done
  
  # copy blobs in $PKG
  cp amd*${amdf}* $PKG/lib/firmware/amd
  cp microcode*${amdf}* $PKG/lib/firmware/amd-ucode
  cp ${agpu}* $PKG/lib/firmware/amdgpu
  cp ${rtlk}* $PKG/lib/firmware/rtl_nic

  # remove blobs from source dir
  cd $SOURCE_DIR
  for c in *.bin *.bin.asc *.fw *.sbin; do
    rm -f $c
  done
}
