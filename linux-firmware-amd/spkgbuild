# description  : Firmware files for Linux

name=linux-firmware-amd
version=20230404
release=1
#source="https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/snapshot/linux-firmware-$version.tar.gz"
baseurl=https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/plain
amdf=fam19h
agpu=green_sardine_
rtlk=rtl8168h-2

build() {

	# AMD UCODE
	acurl=${baseurl}/amd-ucode/microcode_amd_

	for c in ${amdf}.bin ${amdf}.bin.asc; do
		curl -Os ${acurl}${c}
	done

	#  AMD 
	curl -Os ${baseurl}/amd/amd_sev_${amdf}_model0xh.sbin
	
	# AMDGPU
	agurl=${baseurl}/amdgpu/

	for g in ${agpu}asd.bin ${agpu}ce.bin ${agpu}dmcub.bin ${agpu}me.bin ${agpu}mec.bin ${agpu}mec2.bin ${agpu}pfp.bin ${agpu}rlc.bin ${agpu}sdma.bin ${agpu}ta.bin ${agpu}vcn.bin; do
		curl -Os ${agurl}${g}
	done
	
	# Realtek 8169
	curl -Os ${baseurl}/rtl_nic/${rtlk}.fw
  
	for i in amd amdgpu amd-ucode rtl_nic; do
		mkdir -pv $PKG/lib/firmware/${i}
	done
  
	cp amd*${amdf}* $PKG/lib/firmware/amd
	cp microcode*${amdf}* $PKG/lib/firmware/amd-ucode
	cp ${agpu}* $PKG/lib/firmware/amdgpu
	cp ${rtlk}* $PKG/lib/firmware/rtl_nic
}
