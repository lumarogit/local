# description	: A tool to automate the creation of suitable stage 1 init binaries for s6-based Linux systems.
# homepage	: https://skarnet.org/software/s6-linux-init/
# depends	: s6-contrib

name=s6-linux-init
version=1.1.2.0
release=1
backup="etc/s6-linux-init/current/scripts/rc.init
        etc/s6-linux-init/current/scripts/rc.shutdown
        etc/s6-linux-init/current/scripts/rc.shutdown.final
        etc/s6-linux-init/current/scripts/runlevel"
source="https://skarnet.org/software/$name/$name-$version.tar.gz
	rc.init  rc.shutdown  rc.shutdown.final  runlevel"


build() {
	cd $name-$version
	./configure \
		--prefix=/usr \
		--libexecdir=/usr/lib \
		--skeldir=/etc/s6-linux-init/skel \
		--enable-shared \
		--disable-static
	make
	make DESTDIR=$PKG install

	# install scripts
	for i in rc.init runlevel rc.shutdown ; do
		install -Dm755 $SRC/$i $PKG/etc/s6-linux-init/skel/$i
	done

	# exec s6-linux-init-maker
	./s6-linux-init-maker -1 \
		-f $PKG/etc/s6-linux-init/skel \
		-G "/sbin/agetty -L -8 tty12 115200" \
		-c /etc/s6-linux-init/current $PKG/etc/s6-linux-init/current

	mkdir -p -m 0755 $PKG/sbin $PKG/etc/s6/rc

	for i in init halt poweroff reboot shutdown telinit ; do
		ln -sf /etc/s6-linux-init/current/bin/$i $PKG/sbin/$i
	done
}
